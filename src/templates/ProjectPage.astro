---
import BaseLayout from "@layouts/BaseLayout.astro";
import Navbar from "@components/Navbar.astro";
import Text from "@components/text/Text.astro";
import type { Project } from "@cms";
import {kFormatter} from "../utils/number";
import ImageCarousel from "../components/common/ImageCarousel.astro";
import Footer from "../components/common/Footer.astro";

interface Props {
	project: Project;
}

const { project }: Props = Astro.props;

let downloads: number | null = null;

const downloadStats = await fetch(`${Astro.url.protocol}//${Astro.url.host}/api/download-stats/${project.slug}.json`);
if (downloadStats.ok) {
    downloads = (await downloadStats.json()).downloads;
}
---
<BaseLayout title={project.title} canonical={`/${project.slug}`}>
    <Navbar activeItem="Projects" />

    <main class="max-w-4xl mx-auto pt-8 px-2 pb-12">
        <header class="mb-8 max-w-2xl mx-auto">
            <h1 class="text-2xl md:text-3xl mb-2">{project.title}</h1>
            <span class="text-lg text-black/70 dark:text-white/70">{project.description}</span>
        </header>

        {project.images.length > 0 && <ImageCarousel images={project.images} />}

        <section class="mb-8 max-w-2xl mx-auto">
            <h2 class="text-lg mb-2">Key Information</h2>

            <table class="col-span-3 w-96 bg-zinc-900 rounded-lg overflow-clip">
                <tr class="border-b border-black/20 dark:border-white/20">
                    <td class="py-3 px-3 font-bold w-32">Language{project.languages.length > 1 && "s"}</td>
                    <td class="py-3 px-3">{project.languages.join(", ")}</td>
                </tr>
                <tr class="border-b last:border-transparent border-black/20 dark:border-white/20">
                    <td class="py-3 px-3 font-bold">Source Code</td>
                    <td class="py-3 px-3">
                        <a
                          href={project.sourceCode}
                          class="text-purple-400 hover:text-purple-500 hover:border-purple-500 border-purple-400 border-b transition-colors"
                        >
                            {project.sourceCode.replace('https://', '')}
                        </a>
                    </td>
                </tr>
							{downloads !== null && (
                      <tr>
                          <td class="py-3 px-3 font-bold">Downloads</td>
                          <td class="py-3 px-3">
														{kFormatter(downloads)}
                          </td>
                      </tr>
							)}
            </table>
        </section>

        <section class="mb-8 max-w-2xl mx-auto">
            <Text content={project.details} />
        </section>
    </main>

    <Footer />
</BaseLayout>
