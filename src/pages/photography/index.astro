---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import PageHeader from "@/components/PageHeader.astro";
import ContainerLayout from "@/layouts/container.astro";

const albums = await getCollection("photography");

// sort by last updated
albums.sort((a, b) => {
    return new Date(b.data.lastUpdated).getTime() - new Date(a.data.lastUpdated).getTime();
});

// group by album category
let albumCategory: { [key: string]: typeof albums } = {};
albums.forEach(album => {
    if (!albumCategory[album.data.category]) {
        albumCategory[album.data.category] = [];
    }

    albumCategory[album.data.category].push(album);
});
---
<ContainerLayout meta={{
    title: 'Amateur Photography by Simon Sorensen',
    description: 'Lots of pictures of cities taken on film which gives a nice warm, nostalgic feeling. Most pictures are taken in London.',
}}>
    <PageHeader title="Photography" subtitle="A collection of continously updated film photography collections." />

    {Object.keys(albumCategory).map(category => (
        <section class="mb-32 last:mb-0">
            <h2 class="text-lg md:text-xl border-b border-zinc-700 mb-4 pb-2">{category}</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-8">
            {albumCategory[category].map(city => (
                <a href={`/photography/${city.data.seo?.slug}/`}>
                    <article>
                        <Image class="mb-8 bg-zinc-800" src={city.data.cover} width={800} alt={''} loading="eager" />

                        <h3 class="font-light font-serif text-3xl mb-2">{city.data.title}</h3>

                        <p class="text-zinc-300">
                            {city.data.seo?.description}
                        </p>
                    </article>
                </a>
            ))}
            </div>
        </section>
    ))}
</ContainerLayout>