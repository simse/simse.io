---
import { createHighlighterCore, loadWasm } from 'shiki/core'
import githubDark from 'shiki/themes/github-dark.mjs'
import js from 'shiki/langs/javascript.mjs'
import ts from 'shiki/langs/typescript.mjs'

interface Props {
  index: number
  isInline: boolean
  class?: string
  node: {
    _type: 'codeBlock'
    _key: string
    language: 'js' | 'ts'
    sourceCode: string
  }
}

const props = Astro.props

// @ts-expect-error
await loadWasm(import('shiki/onig.wasm?url'))

const highlighter = await createHighlighterCore({
  themes: [githubDark],
  langs: [js, ts],
})

// @ts-expect-error
const highlightedCode = highlighter.codeToHtml(props.node.sourceCode, {
  theme: 'github-dark',
  lang: props.node.language,
})
---

<Fragment set:html={highlightedCode} />
