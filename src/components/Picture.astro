---
import { getImage } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
    image: ImageMetadata;
    alt: string;
    class?: string;
}

const props = Astro.props;

const image = await getImage({
    src: props.image,
    format: 'avif',
    quality: 'high',
    width: 2000
});

const isHorizontal = image.attributes.width > image.attributes.height;
const isVertical = image.attributes.width < image.attributes.height;
---
<style lang="scss">
    picture {
        display: block;
        aspect-ratio: var(--aspect-ratio);
    }

    picture.horizontal {
        width: min(100vw, 1200px);
        height: auto;
    }

    picture.vertical {
        width: calc(80vh * var(--aspect-ratio));
        max-height: 80vh;
        max-width: 100vw;
    }

    img {
        width: 100%;
        height: 100%;
    }
</style>

<picture 
    class={`bg-zinc-800 ${isHorizontal ? 'horizontal' : 'vertical'}`} 
    style={`--aspect-ratio:${image.attributes.width / image.attributes.height};`}
>
    <img src={image.src} alt={props.alt} class={props.class} loading="lazy" decoding="async" />
</picture>