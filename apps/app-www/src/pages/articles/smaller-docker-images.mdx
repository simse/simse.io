---
slug: smaller-docker-images
layout: '../../layouts/Article.astro' 
title: Reducing The Size of Docker Images
description: Docker images big
date: '2022-08-11'
image: https://cdn.discordapp.com/attachments/1007018229539020810/1007409031436042320/simse_a_boy_looking_over_a_cliff_using_binoculars_on_a_warm_sum_9f85f352-39cb-4afb-bd19-3a7d7fa559fc.png
imageCredit: Generated with Midjourney, although largely unrelated, it's a very nice picture.
imageAlt: A row of buildings in Riga
categories: [ 'efficient-computing', 'opinion' ]
---

**Welcome valued readers.** Today I will be sharing tips and tricks on how to reduce the size of your Docker images.

### Why worry about size?
It might seem strange to spend time optimizing the size of a Docker image, especially when storage is cheap. But you know what isn't cheap? _Time!_

Smaller container sizes, means faster uploads and faster downloads. In practice, your images can move from CI to infrastructure quicker. Or from internet to user quicker.

Hmmm, I sense you're convinced by my reasoning. So let's get going.

First I'll go through 

### Example project
I have chosen [a large React app](https://github.com/cypress-io/cypress-realworld-app) created by the Cypress team as the example project. It was created to showcase end-to-end testing, so it's got tons of dependencies and fat to trim.

### Baseline image
First, let's create a basic Docker image for this project.

```dockerfile
FROM node:16.14.2

WORKDIR /app
COPY . /app

RUN yarn
RUN yarn build:ci
```

The uncompressed size of this image is **4.7GB**. After picking picking up my jaw from the floor, I am now writing this sentence crying, screaming, vomitting and vibrating. Let's trim this image nice and good.

## Alpine base image
Most language images are based on Ubuntu or Debian. Very convenient and easy to work with, but also quite large.

Alpine Linux is much smaller, but also diffent in almost every way. For example, instead of Glibc it has musl, which can be problematic when compiling native modules for Node.js.

Let's switch over to Alpine.
```dockerfile
FROM node:16.14.2-alpine

WORKDIR /app
COPY . /app

RUN yarn
RUN yarn build:ci
```

With this change, the image size is now **2.7GB**. It's better but still unacceptable. Only when dealing with JS is a 800MB size reduction, only "pretty good".

## Multi-stage builds
With multi-stage builds we can first build the project, copy the resulting files to a new image, and then install only runtime dependencies. 

```dockerfile
FROM node:16.14.2 AS builder

WORKDIR /app
COPY . /app

RUN yarn
RUN yarn build:ci

FROM node:16.14.2-alpine

WORKDIR /app
COPY --from=builder /app/build ./build
COPY --from=builder /app/backend ./backend
COPY --from=builder /app/data ./data
COPY --from=builder /app/public ./public
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/yarn.lock ./yarn.lock
COPY --from=builder /app/tsconfig.json ./tsconfig.json
COPY --from=builder /app/tsconfig.tsnode.json ./tsconfig.tsnode.json
RUN yarn --prod --frozen-lockfile
```

This change brings down the image to **1.3GB**.

## The Final Hammer
While it's an impressive reduction in image size, the final size is still way too big. To solve this, let's pull out the big hammer.

The name of the hammer is `docker-slim`. It's extremely effective, but _can_ be flaky if not used with caution. That's why I've left it for last.

Running `docker-slim` on the baseline image yields a slimmed image with a size of **284MB**. That's a size reduction of **94%**. _That_ is impressive. 

## The dangers of `docker-slim`


WoooooOOOoOOOoo